{"version":3,"file":"context.js","names":["path","require","fs","_","IGNORED_FILES_CONFIG_PATH","join","process","cwd","DEFAULT_WWW_FOLDER","DEFAULT_CLI_CONFIG","DEFAULT_IGNORE_LIST","module","exports","context","argv","Context","defaultConfig","sourceDirectory","getSourceDirectory","manifestFilePath","projectsConfigFilePath","ignoredFiles","getIgnoredFiles","consoleArgs","length","projectIgnore","readIgnoredFilesProjectConfig","ignoredList","union","remove","item","indexOf","trim","pathToConfig","fileContent","readFileSync","e","split"],"sources":["../src/context.js"],"sourcesContent":["(function() {\n\n  var path = require('path');\n  var fs = require('fs-extra');\n  var _ = require('lodash');\n  var IGNORED_FILES_CONFIG_PATH = path.join(process.cwd(), '.chcpignore');\n  var DEFAULT_WWW_FOLDER = path.join(process.cwd(), 'www');\n  var DEFAULT_CLI_CONFIG = path.join(process.cwd(), 'cordova-hcp.json');\n  var DEFAULT_IGNORE_LIST = [\n      '.DS_Store',\n      'node_modules/*',\n      'node_modules\\\\*',\n      'chcp.json',\n      'chcp.manifest',\n      '.chcp*',\n      '.gitignore',\n      '.gitkeep',\n      '.git',\n      'package.json'];\n\n  module.exports = {\n    context : context\n  };\n\n  function context(argv) {\n    return new Context(argv);\n  }\n\n  var Context = function(argv) {\n    this.argv = argv ? argv : {};\n    this.defaultConfig = DEFAULT_CLI_CONFIG;\n    this.sourceDirectory = getSourceDirectory(argv);\n    this.manifestFilePath = path.join(this.sourceDirectory, 'chcp.manifest');\n    this.projectsConfigFilePath = path.join(this.sourceDirectory, 'chcp.json');\n    this.ignoredFiles = getIgnoredFiles();\n  };\n\n  function getSourceDirectory(argv) {\n    var consoleArgs = argv._;\n    if (!consoleArgs || consoleArgs.length !== 2) {\n      return DEFAULT_WWW_FOLDER;\n    }\n\n    return path.join(process.cwd(), consoleArgs[1]);\n  }\n\n  function getIgnoredFiles() {\n    var projectIgnore = readIgnoredFilesProjectConfig(IGNORED_FILES_CONFIG_PATH);\n    var ignoredList = _.union(DEFAULT_IGNORE_LIST, projectIgnore);\n\n    // remove comments and empty items\n    _.remove(ignoredList, function(item) {\n      return item.indexOf('#') === 0 || _.trim(item).length === 0;\n    });\n\n    return ignoredList;\n  }\n\n  function readIgnoredFilesProjectConfig(pathToConfig) {\n    var fileContent;\n    try {\n      fileContent = fs.readFileSync(pathToConfig, 'utf8');\n    } catch (e) {\n      return [];\n    }\n\n    return _.trim(fileContent).split(/\\n/);\n  }\n\n})();\n"],"mappings":";;AAAA,CAAC,YAAW;EAEV,IAAIA,IAAI,GAAGC,OAAO,CAAC,MAAM,CAAC;EAC1B,IAAIC,EAAE,GAAGD,OAAO,CAAC,UAAU,CAAC;EAC5B,IAAIE,CAAC,GAAGF,OAAO,CAAC,QAAQ,CAAC;EACzB,IAAIG,yBAAyB,GAAGJ,IAAI,CAACK,IAAI,CAACC,OAAO,CAACC,GAAG,CAAC,CAAC,EAAE,aAAa,CAAC;EACvE,IAAIC,kBAAkB,GAAGR,IAAI,CAACK,IAAI,CAACC,OAAO,CAACC,GAAG,CAAC,CAAC,EAAE,KAAK,CAAC;EACxD,IAAIE,kBAAkB,GAAGT,IAAI,CAACK,IAAI,CAACC,OAAO,CAACC,GAAG,CAAC,CAAC,EAAE,kBAAkB,CAAC;EACrE,IAAIG,mBAAmB,GAAG,CACtB,WAAW,EACX,gBAAgB,EAChB,iBAAiB,EACjB,WAAW,EACX,eAAe,EACf,QAAQ,EACR,YAAY,EACZ,UAAU,EACV,MAAM,EACN,cAAc,CAAC;EAEnBC,MAAM,CAACC,OAAO,GAAG;IACfC,OAAO,EAAGA;EACZ,CAAC;EAED,SAASA,OAAOA,CAACC,IAAI,EAAE;IACrB,OAAO,IAAIC,OAAO,CAACD,IAAI,CAAC;EAC1B;EAEA,IAAIC,OAAO,GAAG,SAAAA,CAASD,IAAI,EAAE;IAC3B,IAAI,CAACA,IAAI,GAAGA,IAAI,GAAGA,IAAI,GAAG,CAAC,CAAC;IAC5B,IAAI,CAACE,aAAa,GAAGP,kBAAkB;IACvC,IAAI,CAACQ,eAAe,GAAGC,kBAAkB,CAACJ,IAAI,CAAC;IAC/C,IAAI,CAACK,gBAAgB,GAAGnB,IAAI,CAACK,IAAI,CAAC,IAAI,CAACY,eAAe,EAAE,eAAe,CAAC;IACxE,IAAI,CAACG,sBAAsB,GAAGpB,IAAI,CAACK,IAAI,CAAC,IAAI,CAACY,eAAe,EAAE,WAAW,CAAC;IAC1E,IAAI,CAACI,YAAY,GAAGC,eAAe,CAAC,CAAC;EACvC,CAAC;EAED,SAASJ,kBAAkBA,CAACJ,IAAI,EAAE;IAChC,IAAIS,WAAW,GAAGT,IAAI,CAACX,CAAC;IACxB,IAAI,CAACoB,WAAW,IAAIA,WAAW,CAACC,MAAM,KAAK,CAAC,EAAE;MAC5C,OAAOhB,kBAAkB;IAC3B;IAEA,OAAOR,IAAI,CAACK,IAAI,CAACC,OAAO,CAACC,GAAG,CAAC,CAAC,EAAEgB,WAAW,CAAC,CAAC,CAAC,CAAC;EACjD;EAEA,SAASD,eAAeA,CAAA,EAAG;IACzB,IAAIG,aAAa,GAAGC,6BAA6B,CAACtB,yBAAyB,CAAC;IAC5E,IAAIuB,WAAW,GAAGxB,CAAC,CAACyB,KAAK,CAAClB,mBAAmB,EAAEe,aAAa,CAAC;;IAE7D;IACAtB,CAAC,CAAC0B,MAAM,CAACF,WAAW,EAAE,UAASG,IAAI,EAAE;MACnC,OAAOA,IAAI,CAACC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI5B,CAAC,CAAC6B,IAAI,CAACF,IAAI,CAAC,CAACN,MAAM,KAAK,CAAC;IAC7D,CAAC,CAAC;IAEF,OAAOG,WAAW;EACpB;EAEA,SAASD,6BAA6BA,CAACO,YAAY,EAAE;IACnD,IAAIC,WAAW;IACf,IAAI;MACFA,WAAW,GAAGhC,EAAE,CAACiC,YAAY,CAACF,YAAY,EAAE,MAAM,CAAC;IACrD,CAAC,CAAC,OAAOG,CAAC,EAAE;MACV,OAAO,EAAE;IACX;IAEA,OAAOjC,CAAC,CAAC6B,IAAI,CAACE,WAAW,CAAC,CAACG,KAAK,CAAC,IAAI,CAAC;EACxC;AAEF,CAAC,EAAE,CAAC","ignoreList":[]}